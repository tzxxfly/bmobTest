var fs = require("fs");
var path = require("path");
var Buffer = require('buffer').Buffer;
//var UglifyJS = require("uglify-js");

var cloud = require("./lib/bmob-cloud-functions.js");

function publish_one(__path, __callback) {
//    var codeAll = fs.readFileSync(__path, "utf8");
//
//    var ast = UglifyJS.parse(codeAll);
//
//    var code = ast.body[0].print_to_string({ beautify: true });
//    var name = ast.body[ast.body.length - 1].body.left.property;

    var group = require(__path);
    var name;
    for (one in group) {
        name = one;
    }
    var code = group[name].toString();

    var pcode = new Buffer(code).toString('base64')
    cloud.update(
        {"name": name, "data": {"code": pcode} },
        function (err, resp) {
            console.log(resp || err);
            if (resp) {
                __callback && __callback(resp);
            }
        }
    )
}

module.exports = publish_one;