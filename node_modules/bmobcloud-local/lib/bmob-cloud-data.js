var CM = require("./../bmob-cloud-common");
var CRequest = CM.Request;
var __Request = function (table, objectId, method, params, callback) {
    CRequest("classes", table, objectId, method, params, callback);
}

var assert = require("assert");

module.exports = (function () {
    var model = {};
    model._SessionToken = "";
    // db._MasterKey = Bmob.masterKey;

    // db.setHeader({"x-bmob-session-token":dataObject.sessionToken});
    // db.setHeader({"X-Bmob-Master-Key":"这里填写Master Key信息"});
    model.setHeader = function (json) {
        var value = json["x-bmob-session-token"];
        if(value){
            model._SessionToken = value;
        }

        value =  json["X-Bmob-Master-Key"];
        if (value) {
            // db._MasterKey = value;
            CM.Bmob.masterKey = value;
            CM.Bmob._useMasterKey = true;
        }
    }

    /**
     find({
     "table":"XXX",          //表名
     "keys":"a,b,c",         //返回字段列表，多个字段用,分隔
     "where":{"a":"XXXX","b":"XXXX"},       //查询条件是一个JSON object
     "order":"-a,b",         //排序列表，[-]字段名称,-表示降序，默认为升序
     "limit":10,            //limit大小，一页返回多少条记录，默认为0
     "skip":2,             //skip,分页offset，(page-1)*limit
     "count":1            //count,只返回符合条件的记录总数
     },function(err,data){    //回调函数
     });

     //获取表"GameScore"的总记录数
     db.find({
     "table":"GameScore",
     "limit":0,
     "count":1
     },function(err,data){
     });
     */
    model.find = function (request, callback) {
        assert.ifError(request.table == null);

        __Request(request.table, request.objectId, "GET", request, callback);
    }

    /**
     findOne({
     "table":"XXX",             //表名
     "objectId":"XXXX"         //记录的objectId
     },function(err,data){         //回调函数
     });
     */
    model.findOne = function (request, callback) {
        assert.ifError(request.table == null);
        assert.ifError(request.objectId == null);

        __Request(request.table, request.objectId, "GET", request, callback);
    }

    /**
     update({
     "table":"XXX",             //表名
     "objectId":"XXXX",        //记录的objectId
     "data":{"a":"XXXX","b":"XXXX"}           //需要更新的数据，格式为JSON
     },function(err,data){         //回调函数
     });
     */
    model.update = function (request, callback) {
        assert.ifError(request.table == null);
        assert.ifError(request.objectId == null);

        __Request(request.table, request.objectId, "PUT", request.data, callback);
    }

    /**
     insert({
     "table":"XXX",             //表名
     "data":{"a":"XXXX","b":"XXXX"}            //需要更新的数据，格式为JSON
     },function(err,data){         //回调函数
     });
     */
    model.insert = function (request, callback) {
        assert.ifError(request.table == null);

        __Request(request.table, null, "POST", request.data, callback);
    }

    /**
     remove({
     "table":"XXX",             //表名
     "objectId":"XXXX"        //记录的objectId
     },function(err,data){         //回调函数
     });
     */
    model.remove = function (request, callback) {
        assert.ifError(request.table == null);
        assert.ifError(request.objectId == null);

        __Request(request.table, request.objectId, "DELETE", null, callback);
    }

    /**
     userSignUp({
     "data":{"a":"XXXX","b":"XXXX"}             //用户注册的信息，格式为JSON {"username":"cooldude6","password":"b_m7!-o8","phone":"415-392-0202"}
     },function(err,data){         //回调函数
     });
     */
    model.userSignUp = function (request, callback) {
        CRequest("users", null, null, "POST", request.data, callback);
    }

    /**
     userLogin({
     "username":"aa",            //登录用户名
     "password":""              //用户密码
     },function(err,data){         //回调函数
     });
     */
    model.userLogin = function (request, callback) {
        CRequest("login", null, null, "GET", request, callback);
    }

    /**
     userRestPassword({
     "data":{"email":"XX@XX.com"}      //需要重置密码的用户邮件账号
     },function(err,data){         //回调函数
     });
     */
    model.userRestPassword = function (request, callback) {
        CRequest("requestPasswordReset", null, null, "POST", request.data, callback);
    }

    /**
     getUserByObjectId({
     "objectId":"XXXX"          //记录的objectId
     },function(err,data){         //回调函数
     });
     */
    model.getUserByObjectId = function (request, callback) {
        CRequest("users", null, request.objectId, "GET", null, callback);
    }

    /**
     updateUserByObjectId({
     "objectId":"XXXX",        //记录的objectId
     "data":{"a":"XXXX","b":"XXXX"}           //需要更新的数据，格式为JSON
     },function(err,data){         //回调函数
     });

     db.setHeader({"x-bmob-session-token":dataObject.sessionToken});
     */
    model.updateUserByObjectId = function (request, callback) {
        CRequest("users", null, request.objectId, "PUT", request.data, callback);
    }

    /**
     getAllUser({function(err,data){         //回调函数
     });
     */
    model.getAllUser = function (request, callback) {
        CRequest("users", null, null, "GET", null, callback);
    }

    /**
     removeUserByObjectId({
     "objectId":"XXXX"        //记录的objectId
     },function(err,data){         //回调函数
     });

     db.setHeader({"x-bmob-session-token":dataObject.sessionToken});
     */
    model.removeUserByObjectId = function (request, callback) {
        CRequest("users", null, request.objectId, "DELETE", null, callback);
    }

    /**
     requestEmailVerify({
     "data":{"email":"coolguy@iloveapps.com"}
     },function(err,data){
     //回调函数
     });
     */
    model.requestEmailVerify = function (request, callback) {
        CRequest("requestEmailVerify", null, null, "POST", request.data, callback);
    }

    return model;
})();