var __Request = require("./../bmob-cloud-common").Request;
var assert = require("assert");

module.exports = (function () {
    var model = {};

    /**
     在云代码中可以调用本app的其它云代码，示例代码如下：

     function onRequest(request, response, modules) {
     var functions = modules.oFunctions;

     functions.run({
     "name": "test",
     "data":{"content":"你好","address":"guangzhou"}
     },function(err,data){
     //回调函数
     });
     }
     在上面的例子中，name是云代码的函数名，data中是传递的参数

     如果不需要传递任何参数，可以用下面的实例代码：

     function onRequest(request, response, modules) {
     var functions = modules.oFunctions;

     functions.run({
     "name": "test"
     },function(err,data){
     //回调函数
     });
     }
     */
    model.run = function (request, callback) {
        assert.ifError(request.name == null);

        __Request("functions", request.name, null, 'POST', request.data, callback);
    }

    /*
    test是该云端代码的函数名，code的值是云端代码经base64编码后的结果

    { "name" : name,
      "data" : {"code":"ZnVuY3Rpb24gb25SZXF1ZXN0KHJlcXVlc3QsIHJlc3BvbnNlLCBtb2R1bGVzKSB7CiAgICAgICAgICAgIHJlc3BvbnNlLmVuZCgiMTExIik7Cn0g"}
    }
     */
    model.update = function (request, callback) {
        assert.ifError(request.name == null);

        __Request("functions", request.name, null, 'PUT', request.data, callback);
    }

    model.delete = function (request, callback) {
        assert.ifError(request.name == null);

        __Request("functions", request.name, null, 'DELETE', request.data, callback);
    }

    return model;
})();