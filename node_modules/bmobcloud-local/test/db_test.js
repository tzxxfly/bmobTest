var modules = require("./../index.js");
var response = {
    end: function (data) {
        console.log(data);
    }
}
var assert = require("assert");

var options = {
    "app_key": "4414150cb439afdf684d37dc184e0f9f",
    "rest_key": "e1deb317442129c125b228ddf78e5f22"
};

var Bmob = require("bmob").Bmob;
Bmob.initialize(options.app_key, options.rest_key);

describe('db', function () {
    var db = modules.oData;

    describe('#()', function () {
        it('insert', function (done) {
            db.insert({
                "table": "GameObject",             //表名
                "data": {"a": "XXXX", "b": "XXXX"}            //需要更新的数据，格式为JSON
            }, function (err, data) {
                //data是json字符串，为了查看方便（无转移字符）将返回结果转换为Json对象
                var resultObject = JSON.parse(data);
                response.end(resultObject);

                done();
            });
        })

        it('find complex', function (done) {
            db.find({
                "table": "GameObject",          //表名
                "keys": "a,b,c",         //返回字段列表，多个字段用,分隔
                "where": {"a": "XXXX", "b": "XXXX"},       //查询条件是一个JSON object
                "order": "-a,b",         //排序列表，[-]字段名称,-表示降序，默认为升序
                "limit": 10,            //limit大小，一页返回多少条记录，默认为0
                "skip": 2,             //skip,分页offset，(page-1)*limit
                "count": 1            //count,只返回符合条件的记录总数
            }, function (err, data) {    //回调函数
                //data是json字符串，为了查看方便（无转移字符）将返回结果转换为Json对象
                var resultObject = JSON.parse(data);
                response.end(resultObject);

                done();
            });
        })

        it('find count', function (done) {
            //获取表"GameScore"的总记录数
            db.find({
                "table": "GameScore",
                "limit": 0,
                "count": 1
            }, function (err, data) {
                //data是json字符串，为了查看方便（无转移字符）将返回结果转换为Json对象
                var resultObject = JSON.parse(data);
                response.end(resultObject);

                done();
            });
        })
    })
})
